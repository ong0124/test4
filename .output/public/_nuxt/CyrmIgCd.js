import{_ as N}from"./NLwD3dW4.js";import V from"./BoSwB06y.js";import{O as I,P,n as C,I as U,Q as q,R as K,G as H,x as z,S as F,T as Y,k as D,H as L,U as G,h as T,V as R,W as X,i as k,X as J,e as Q,D as W,Y as Z,g as A,j as ee,o as te,c as ae,a as s,b as j,t as u,p as S,Z as ne,y as se,F as oe}from"./DfY4Dsmv.js";import{d as E}from"./D8ZMcQSb.js";const re=a=>a==="defer"||a===!1;function ie(...a){var r;const i=typeof a[a.length-1]=="string"?a.pop():void 0;typeof a[0]!="string"&&a.unshift(i);let[n,d,e={}]=a;if(typeof n!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof d!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const t=I(),h=d,_=()=>P.value,$=()=>t.isHydrating?t.payload.data[n]:t.static.data[n];e.server=e.server??!0,e.default=e.default??_,e.getCachedData=e.getCachedData??$,e.lazy=e.lazy??!1,e.immediate=e.immediate??!0,e.deep=e.deep??P.deep,e.dedupe=e.dedupe??"cancel";const g=e.getCachedData(n,t),w=g!=null;if(!t._asyncData[n]||!e.immediate){(r=t.payload._errors)[n]??(r[n]=P.errorValue);const f=e.deep?C:U;t._asyncData[n]={data:f(w?g:e.default()),pending:C(!w),error:q(t.payload._errors,n),status:C("idle"),_default:e.default}}const l={...t._asyncData[n]};delete l._default,l.refresh=l.execute=(f={})=>{if(t._asyncDataPromises[n]){if(re(f.dedupe??e.dedupe))return t._asyncDataPromises[n];t._asyncDataPromises[n].cancelled=!0}if(f._initial||t.isHydrating&&f._initial!==!1){const p=f._initial?g:e.getCachedData(n,t);if(p!=null)return Promise.resolve(p)}l.pending.value=!0,l.status.value="pending";const m=new Promise((p,c)=>{try{p(h(t))}catch(O){c(O)}}).then(async p=>{if(m.cancelled)return t._asyncDataPromises[n];let c=p;e.transform&&(c=await e.transform(p)),e.pick&&(c=ue(c,e.pick)),t.payload.data[n]=c,l.data.value=c,l.error.value=P.errorValue,l.status.value="success"}).catch(p=>{if(m.cancelled)return t._asyncDataPromises[n];l.error.value=Y(p),l.data.value=D(e.default()),l.status.value="error"}).finally(()=>{m.cancelled||(l.pending.value=!1,delete t._asyncDataPromises[n])});return t._asyncDataPromises[n]=m,t._asyncDataPromises[n]},l.clear=()=>le(t,n);const v=()=>l.refresh({_initial:!0}),b=e.server!==!1&&t.payload.serverRendered;{const f=L();if(f&&b&&e.immediate&&!f.sp&&(f.sp=[]),f&&!f._nuxtOnBeforeMountCbs){f._nuxtOnBeforeMountCbs=[];const c=f._nuxtOnBeforeMountCbs;K(()=>{c.forEach(O=>{O()}),c.splice(0,c.length)}),H(()=>c.splice(0,c.length))}b&&t.isHydrating&&(l.error.value||g!=null)?(l.pending.value=!1,l.status.value=l.error.value?"error":"success"):f&&(t.payload.serverRendered&&t.isHydrating||e.lazy)&&e.immediate?f._nuxtOnBeforeMountCbs.push(v):e.immediate&&v();const m=G();if(e.watch){const c=z(e.watch,()=>l.refresh());m&&F(c)}const p=t.hook("app:data:refresh",async c=>{(!c||c.includes(n))&&await l.refresh()});m&&F(p)}const o=Promise.resolve(t._asyncDataPromises[n]).then(()=>l);return Object.assign(o,l),o}function le(a,i){i in a.payload.data&&(a.payload.data[i]=void 0),i in a.payload._errors&&(a.payload._errors[i]=P.errorValue),a._asyncData[i]&&(a._asyncData[i].data.value=void 0,a._asyncData[i].error.value=P.errorValue,a._asyncData[i].pending.value=!1,a._asyncData[i].status.value="idle"),i in a._asyncDataPromises&&(a._asyncDataPromises[i]&&(a._asyncDataPromises[i].cancelled=!0),a._asyncDataPromises[i]=void 0)}function ue(a,i){const n={};for(const d of i)n[d]=a[d];return n}function ce(a,i,n){const[d={},e]=typeof i=="string"?[{},i]:[i,n],t=T(()=>R(a)),h=d.key||X([e,typeof t.value=="string"?t.value:"",...de(d)]);if(!h||typeof h!="string")throw new TypeError("[nuxt] [useFetch] key must be a string: "+h);if(!a)throw new Error("[nuxt] [useFetch] request is missing.");const _=h===e?"$f"+h:h;if(!d.baseURL&&typeof t.value=="string"&&t.value[0]==="/"&&t.value[1]==="/")throw new Error('[nuxt] [useFetch] the request URL must not start with "//".');const{server:$,lazy:g,default:w,transform:l,pick:v,watch:b,immediate:o,getCachedData:r,deep:f,dedupe:m,...p}=d,c=k({...J,...p,cache:typeof d.cache=="boolean"?void 0:d.cache}),O={server:$,lazy:g,default:w,transform:l,pick:v,immediate:o,getCachedData:r,deep:f,dedupe:m,watch:b===!1?[]:[c,t,...b||[]]};let y;return ie(_,()=>{var x;(x=y==null?void 0:y.abort)==null||x.call(y,new DOMException("Request aborted as another request to the same endpoint was initiated.","AbortError")),y=typeof AbortController<"u"?new AbortController:{};const M=R(d.timeout);let B;return M&&(B=setTimeout(()=>y.abort(new DOMException("Request aborted due to timeout.","AbortError")),M),y.signal.onabort=()=>clearTimeout(B)),(d.$fetch||globalThis.$fetch)(t.value,{signal:y.signal,...c}).finally(()=>{clearTimeout(B)})},O)}function de(a){var n;const i=[((n=R(a.method))==null?void 0:n.toUpperCase())||"GET",R(a.baseURL)];for(const d of[a.params||a.query]){const e=R(d);if(!e)continue;const t={};for(const[h,_]of Object.entries(e))t[R(h)]=R(_);i.push(t)}return i}const fe={class:"py-4 border-b bg-green-400 flex items-center"},_e={class:"absolute left-1/2 transform -translate-x-1/2 text-xl font-bold capitalize"},pe={class:"px-6 pt-4 pb-4"},he={class:"bg-white p-4 rounded-lg flex flex-col mb-4"},me={class:"font-bold text-lg"},ye={class:"flex border-b-2 py-2"},ge={class:"pl-4"},ve={class:"flex ml-32"},De={class:"flex py-2"},be={class:"mx-auto"},Re={class:"mx-auto"},we={class:"flex"},Pe={class:"flex py-2"},$e={class:"self-center pr-2"},Oe={value:"RefundType1"},Te={value:"RefundType2"},Ce={value:"RefundType3"},Be={value:"RefundType4"},Ee={value:"RefundType5"},ke={value:"RefundType6"},Me={class:""},xe={class:"flex justify-end pt-6"},Ue=Q({__name:"[id]",setup(a){const i=W(),n=Z(),d=i.params.id,{t:e}=A(),t=C(""),h=C(""),_=k({trip_type:"",user_id:"",adult_num:"",child_num:"",contact_phone:"",totalprice:"",contact_name:"",departure_loc:"",destination_loc:"",return_departure:"",return_destination:"",arrivalpoint_date:"",arrivalpoint_time:"",flight_num:"",ferry_time:"",flight_time:"",shuttle_date:E(),shuttle_time:"",return_shuttle_date:E(),return_shuttle_time:""}),$=T(()=>e(_.departure_loc||"defaultKey")),g=T(()=>e(_.destination_loc||"defaultKey"));T(()=>e(_.return_departure||"defaultKey")),T(()=>e(_.return_destination||"defaultKey"));const w=async()=>{try{const r=(await $fetch(`/api/FindBookingDetailById/${d}`)).data;Object.assign(_,{trip_type:r.trip_type,user_id:r.user_id,adult_num:r.adult_num,child_num:r.child_num,contact_phone:r.contact_phone,totalprice:r.totalprice,contact_name:r.contact_name,departure_loc:r.departure_loc,destination_loc:r.destination_loc,return_departure:r.return_departure,return_destination:r.return_destination,arrivalpoint_date:r.arrivalpoint_date,arrivalpoint_time:r.arrivalpoint_time,flight_num:r.flight_num,ferry_time:r.ferry_time,flight_time:r.flight_time,shuttle_date:r.shuttle_date,shuttle_time:r.shuttle_time,return_shuttle_date:r.return_shuttle_date,return_shuttle_time:r.return_shuttle_time}),console.log("form:",_)}catch(o){console.error("Error fetching booking:",o),alert("Get blog detail error")}},l=o=>o?E(o).format("YYYY-MM-DD"):"N/A",v=k({booking_id:d,user_id:7,get refund_type(){return t.value},get reason(){return h.value}});console.log("checkRefundForm"+JSON.stringify(v));const b=async()=>{if(!t.value){alert(e("alertMessage11"));return}try{await ce(`/api/PostRefund/${d}`,{method:"POST",body:v},"$DBxmHNO8jA"),console.log("check:"+JSON.stringify(v)),alert(e("alertMessage9")),n.push("/")}catch(o){console.error("Refund request failed:",o),alert("Failed to apply for a refund. Please try again.")}};return ee(w),(o,r)=>{const f=N,m=V;return te(),ae(oe,null,[s("header",fe,[s("div",null,[j(f)]),s("h1",_e,u(o.$t("RefundPage.title")),1)]),s("div",pe,[s("div",he,[s("div",null,[s("p",me,u(o.$t("confirmationPage.tripInfo")),1)]),s("div",ye,[s("p",null,u(l(D(_).shuttle_date)),1),s("p",ge,u(D(_).shuttle_time),1),s("div",ve,[s("p",null,u(D($)),1),j(m,{name:"material-symbols-arrow-right-alt",class:"mx-2 w-6 h-6"}),s("p",null,u(D(g)),1)])]),s("p",null,u(o.$t("Booking.flightNumber"))+" : MF1544",1),s("div",De,[s("p",null,u(o.$t("Booking.adultTicket"))+" X "+u(D(_).adult_num),1),s("p",be,u(o.$t("Booking.childTicket"))+" X "+u(D(_).child_num),1),s("p",Re,u(o.$t("RefundPage.paid"))+" : NT$ "+u(o.$t("confirmationPage.amount")),1)]),s("div",we,[s("p",null,u(o.$t("Booking.contact"))+" ï¼š",1),s("p",null,u(D(_).contact_name),1)]),s("div",Pe,[s("label",$e,u(o.$t("RefundPage.refundType"))+" :",1),S(s("select",{"onUpdate:modelValue":r[0]||(r[0]=p=>t.value=p),class:"w-4/6 h-fit border rounded-lg px-3 py-2 focus:ring-green-500"},[s("option",Oe,u(o.$t("RefundPage.changeOfPlans")),1),s("option",Te,u(o.$t("RefundPage.tripCancellationOrAdjustment")),1),s("option",Ce,u(o.$t("RefundPage.bookingError")),1),s("option",Be,u(o.$t("RefundPage.flightOrFerryIssue")),1),s("option",Ee,u(o.$t("RefundPage.systemError")),1),s("option",ke,u(o.$t("RefundPage.other")),1)],512),[[ne,t.value]])]),s("label",Me,u(o.$t("RefundPage.refundReason"))+" :",1),S(s("textarea",{"onUpdate:modelValue":r[1]||(r[1]=p=>h.value=p),placeholder:" ",class:"w-full border rounded-lg px-3 py-2 h-24"},null,512),[[se,h.value]]),s("div",xe,[s("button",{onClick:b,class:"bg-green-400 text-white w-1/6 py-2 rounded flex justify-center"},u(o.$t("RefundPage.applyRefund")),1)])])])],64)}}});export{Ue as default};
